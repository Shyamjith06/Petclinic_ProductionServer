node {
 stage('Git-Checkout for ansible') {
<<<<<<< HEAD
   git 'https://github.com/Shyamjith06/Petclinic_ProductionServer.git'
=======
   git 'https://github.com/Shyamjith06/ansible-2.git'
>>>>>>> d1a45f8b247a624eaca83d1a31afa4b0cbd79180
  }
  stage('Geting Ready For Ansible') {
    def server= Artifactory.server 'Artifactory'
        def downloadSpec = """{
            "files": [{
            "pattern": "petclinic-1/petclinic.war",
<<<<<<< HEAD
            "target": "ansible/templates/app/" }]
=======
            "target": "ansible/templates/apps/" }]
>>>>>>> d1a45f8b247a624eaca83d1a31afa4b0cbd79180
        }"""
    server.download(downloadSpec)  
  sh label: 'Jenkins', script: "echo '<h1> TASK BUILD ID: ${env.BUILD_DISPLAY_NAME}</h1>' > ansible/templates/app/index.html"
 }
  def project_ansible="ansible"
  dir(project_ansible) { 
  stage('Prod Deployment on AWS'){
<<<<<<< HEAD
  sh label: 'terraform', script: 'ansible-playbook -i /root/.jenkins/workspace/Petclinic_Infrastructure/Terraform/jenkins-ci.ini -u ubuntu --key /root/.ssh/mydevops.pem web-playbook.yaml'
=======
  sh label: 'terraform', script: 'ansible-playbook -i /root/.jenkins/workspace/Terraform-1/Terraform/jenkins-ci.ini -u ubuntu --key /root/.ssh/mydevops.pem web-playbook.yaml'
>>>>>>> d1a45f8b247a624eaca83d1a31afa4b0cbd79180
     } 
   }
}
